--// Services
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

--// GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SpectatorGui"
ScreenGui.Parent = game:GetService("CoreGui")
ScreenGui.ResetOnSpawn = false

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 300, 0, 180)
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -90)
MainFrame.BackgroundColor3 = Color3.fromRGB(20,20,20)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = MainFrame

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -35, 0, 30)
Title.Position = UDim2.new(0,0,0,0)
Title.BackgroundColor3 = Color3.fromRGB(40,40,40)
Title.Text = "Spectator | CCTV"
Title.TextColor3 = Color3.fromRGB(255,255,255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18
Title.BorderSizePixel = 0
Title.Parent = MainFrame

local CloseBtn = Instance.new("TextButton")
CloseBtn.Size = UDim2.new(0,30,0,30)
CloseBtn.Position = UDim2.new(1,-30,0,0)
CloseBtn.BackgroundColor3 = Color3.fromRGB(200,0,0)
CloseBtn.Text = "X"
CloseBtn.TextColor3 = Color3.fromRGB(255,255,255)
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.TextSize = 16
CloseBtn.BorderSizePixel = 0
CloseBtn.Parent = MainFrame

local DisplayLabel = Instance.new("TextLabel")
DisplayLabel.Size = UDim2.new(1, -20, 0, 30)
DisplayLabel.Position = UDim2.new(0, 10, 0, 40)
DisplayLabel.BackgroundTransparency = 1
DisplayLabel.Text = "Display: None"
DisplayLabel.TextColor3 = Color3.fromRGB(255,255,255)
DisplayLabel.Font = Enum.Font.GothamBold
DisplayLabel.TextSize = 16
DisplayLabel.TextXAlignment = Enum.TextXAlignment.Left
DisplayLabel.Parent = MainFrame

local PlayerLabel = Instance.new("TextLabel")
PlayerLabel.Size = UDim2.new(1, -20, 0, 30)
PlayerLabel.Position = UDim2.new(0, 10, 0, 70)
PlayerLabel.BackgroundTransparency = 1
PlayerLabel.Text = "Target: None"
PlayerLabel.TextColor3 = Color3.fromRGB(255,255,255)
PlayerLabel.Font = Enum.Font.GothamBold
PlayerLabel.TextSize = 16
PlayerLabel.TextXAlignment = Enum.TextXAlignment.Left
PlayerLabel.Parent = MainFrame

local LeftBtn = Instance.new("TextButton")
LeftBtn.Size = UDim2.new(0,50,0,30)
LeftBtn.Position = UDim2.new(0, 20, 0, 120)
LeftBtn.BackgroundColor3 = Color3.fromRGB(100,100,100)
LeftBtn.Text = "<"
LeftBtn.TextColor3 = Color3.fromRGB(255,255,255)
LeftBtn.Font = Enum.Font.GothamBold
LeftBtn.TextSize = 18
LeftBtn.Parent = MainFrame

local RightBtn = Instance.new("TextButton")
RightBtn.Size = UDim2.new(0,50,0,30)
RightBtn.Position = UDim2.new(1,-70,0,120)
RightBtn.BackgroundColor3 = Color3.fromRGB(100,100,100)
RightBtn.Text = ">"
RightBtn.TextColor3 = Color3.fromRGB(255,255,255)
RightBtn.Font = Enum.Font.GothamBold
RightBtn.TextSize = 18
RightBtn.Parent = MainFrame

local TPBtn = Instance.new("TextButton")
TPBtn.Size = UDim2.new(0.6,0,0,35)
TPBtn.Position = UDim2.new(0.2,0,0,150)
TPBtn.BackgroundColor3 = Color3.fromRGB(255,255,255)
TPBtn.Text = "Teleport"
TPBtn.TextColor3 = Color3.fromRGB(0,0,0)
TPBtn.Font = Enum.Font.GothamBold
TPBtn.TextSize = 16
TPBtn.Parent = MainFrame

--// Variables
local playersList = {}
local index = 1
local targetPlayer = nil
local cameraFollowConnection = nil

--// Functions
local function updateTargetText()
	if targetPlayer then
		DisplayLabel.Text = "Display: "..(targetPlayer.DisplayName or "None")
		PlayerLabel.Text = "Target: "..(targetPlayer.Name or "None")
	else
		DisplayLabel.Text = "Display: None"
		PlayerLabel.Text = "Target: None"
	end
end

local function refreshPlayers()
	playersList = {}
	for _,plr in ipairs(Players:GetPlayers()) do
		if plr ~= LocalPlayer then
			table.insert(playersList, plr)
		end
	end
	if #playersList > 0 then
		index = 1
		targetPlayer = playersList[index]
	else
		targetPlayer = nil
	end
	updateTargetText()
end

local function followCamera()
	if cameraFollowConnection then
		cameraFollowConnection:Disconnect()
	end
	cameraFollowConnection = game:GetService("RunService").RenderStepped:Connect(function()
		if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
			Camera.CameraType = Enum.CameraType.Scriptable
			Camera.CFrame = targetPlayer.Character.HumanoidRootPart.CFrame * CFrame.new(0,3,6)
			Camera.CFrame = CFrame.new(Camera.CFrame.Position, targetPlayer.Character.HumanoidRootPart.Position)
		end
	end)
end

--// Buttons
CloseBtn.MouseButton1Click:Connect(function()
	MainFrame.Visible = false
	if cameraFollowConnection then
		cameraFollowConnection:Disconnect()
	end
	Camera.CameraType = Enum.CameraType.Custom
end)

LeftBtn.MouseButton1Click:Connect(function()
	if #playersList > 0 then
		index = (index - 2) % #playersList + 1
		targetPlayer = playersList[index]
		updateTargetText()
		followCamera()
	end
end)

RightBtn.MouseButton1Click:Connect(function()
	if #playersList > 0 then
		index = index % #playersList + 1
		targetPlayer = playersList[index]
		updateTargetText()
		followCamera()
	end
end)

TPBtn.MouseButton1Click:Connect(function()
	if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
		local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
		if root then
			root.CFrame = targetPlayer.Character.HumanoidRootPart.CFrame + Vector3.new(0,3,0)
		end
	end
end)

Players.PlayerAdded:Connect(refreshPlayers)
Players.PlayerRemoving:Connect(refreshPlayers)
refreshPlayers()
followCamera()
